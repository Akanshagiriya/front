<ng-container *ngIf="ready">
  <ng-container *ngIf="!isProDomain">
    <ng-container *ngIf="useNewNavigation; else v2Topbar">
      <m-v3-topbar>
        <ng-container search>
          <m-search--bar [defaultSizes]="false"></m-search--bar>
        </ng-container>
      </m-v3-topbar>
    </ng-container>

    <ng-template #v2Topbar>
      <m-v2-topbar *mIfFeature="'top-feeds'; else legacyTopbar">
        <ng-container search>
          <m-search--bar [defaultSizes]="false"></m-search--bar>
        </ng-container>

        <ng-container icons>
          <m-notifications--topbar-toggle
            *ngIf="session.isLoggedIn()"
          ></m-notifications--topbar-toggle>
        </ng-container>
      </m-v2-topbar>
      <ng-template #legacyTopbar>
        <m-topbar class="m-noshadow">
          <ng-container search>
            <m-search--bar></m-search--bar>
          </ng-container>

          <ng-container icons>
            <m-notifications--topbar-toggle></m-notifications--topbar-toggle>
            <m-wallet--topbar-toggle></m-wallet--topbar-toggle>
          </ng-container>
        </m-topbar>
      </ng-template>

      <m-sidebar--markers
        [class.has-v2-navbar]="featuresService.has('top-feeds')"
      ></m-sidebar--markers>
    </ng-template>
  </ng-container>

  <m-body
    [class.has-v2-navbar]="featuresService.has('top-feeds')"
    [class.has-v3-navbar]="featuresService.has('navigation-2020')"
    [class.is-pro-domain]="isProDomain"
  >
    <m-emailConfirmation></m-emailConfirmation>
    <m-announcement [id]="'blockchain:sale'" *ngIf="false">
      <span
        class="m-blockchain--wallet-address-notice--action"
        routerLink="/tokens"
        i18n="@@BLOCKCHAIN__SALE__NOTICE"
      >
        The MINDS token is now live. Learn more here.
      </span>
    </m-announcement>
    <m-blockchain--wallet-address-notice></m-blockchain--wallet-address-notice>
    <ng-container *ngIf="useNewNavigation; else oldLayout">
      <div class="m-grid">
        <m-sidebar--navigation></m-sidebar--navigation>
        <router-outlet></router-outlet>
      </div>
    </ng-container>
    <ng-template #oldLayout>
      <router-outlet></router-outlet>
    </ng-template>
  </m-body>

  <m-messenger *ngIf="minds.LoggedIn && !isProDomain"></m-messenger>

  <m-hovercard-popup></m-hovercard-popup>

  <m-overlay-modal></m-overlay-modal>
  <m--blockchain--transaction-overlay></m--blockchain--transaction-overlay>
  <m-modal--tos-updated *ngIf="session.isLoggedIn()"></m-modal--tos-updated>
  <m-juryDutySession__summons
    *ngIf="session.isLoggedIn() && !isProDomain"
  ></m-juryDutySession__summons>

  <m-modal-signup-on-scroll *ngIf="!isProDomain"></m-modal-signup-on-scroll>

  <m-channel--onboarding *ngIf="showOnboarding"></m-channel--onboarding>

  <m-cookies-notice *ngIf="!session.isLoggedIn()"></m-cookies-notice>
</ng-container>
